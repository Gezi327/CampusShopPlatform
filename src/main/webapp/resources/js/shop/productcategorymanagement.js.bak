/**
 * Created by cheng on 2018/4/4.
 *
 * TODO 未实现的版本 -- 将删除改为左滑删除，而不是按钮删除
 */

(function () {

    'use strict';

    var listUrl = '/shopadmin/getproductcategorylist',
        addUrl = '/shopadmin/addproductcategories',
        deleteUrl = '/shopadmin/removeproductcategory';

    // 初始化商品分类管理列表
    getList();

    function getList() {
        $.getJSON(listUrl, function (data) {
            if (data.success) {
                handleList(data.data);
            }
        });
    }

    function handleList(data) {
        var categoryListHtml = '';
        data.map(function (item) {
            categoryListHtml += '<div class="weui-cell weui-cell_swiped">'
                + '<div class="weui-cell__bd swipe-left"><div class="weui-cell">'
                + '<div class="weui-cell__bd">'
                + '<label class="weui-textarea">' + item.productCategoryName + '</label>'
                + '</div>'
                + '<div class="weui-cell__hd"><label class="weui-label">' + item.priority + '</label></div>'
                + '</div></div>'
                + '<div class="weui-cell__ft">'
                + '<a class="weui-swiped-btn weui-swiped-btn_warn" href="javascript:;">删除</a>'
                + '</div>'
                + '</div>';
        });
        $('#category-list').appendChild(categoryListHtml);

        add($('.swipe-left'));
    }


    function add($swipe_left) {
        var pressedObj, start, end, isOpen = false, px;
        // 添加左滑事件
        $swipe_left.on('touchstart', function (e) {
            start = e.changedTouches[0].pageX;
        });

        $swipe_left.on('touchmove', function (e) {
            end = e.changedTouches[0].pageX;
            console.log(isOpen);
            px = end - start;
            console.log(px);
            if (!isOpen && px < 0 && px >= -68) {
                $swipe_left.css('transform', 'translateX(' + px + 'px)');
            }
            if (isOpen && px > 0 && px <= 68) {
                $swipe_left.css('transform', 'translateX(' + (-68 + px) + 'px)');
            }
        });

        $swipe_left.on('touchend', function () {
            if (start > end) {
                $swipe_left.css('transform', 'translateX(-68px)');
                isOpen = true;
            } else {
                $swipe_left.css('transform', 'translateX(0)');
                isOpen = false;
            }
        });
    }
})();


